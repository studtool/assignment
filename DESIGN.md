
# Проектирование системы

## Концептуальный дизайн

Для создания функциональной модели системы, отражающей основные функции и потоки информации наиболее наглядно использовать нотацию IDEF0. На рисунке 1 приведена концептуальная модель сервиса документов. На рисунках 2, 3 представлена декомпозиция функциональной модели сервиса.

![Alt text](https://github.com/studtool/assignment/blob/master/A0.png)

Рис. 1. Концептуальная модель подсистемы обработки документов

![Alt text](https://github.com/studtool/assignment/blob/master/A1-A3.PNG)

Рис. 2. Детализированная концептуальная модель подсистемы обработки документов

![Alt text](https://github.com/studtool/assignment/blob/master/IDEF3.png)

Рис. 3. Диаграмма изменения документа в нотации IDEF3

### Сценарии функционирования системы

#### Добавление документа

1. Пользователь создает документ и нажимает кнопку "Добавить документ".
2. Запрос на добавление документа отправляется на сервер.
3. Сервис авторизации выполняет проверку авторизации пользователя. В случае если пользователь авторизован выставляется заголовок, содержащий идентификатор пользователя, иначе генерируется сообщение об ошибке.
4. Сервис документов создает документ и генерирует сообщение об успешном завершении обработки запроса.
5. Фронтенд генерирует страницу с сообщением об успешном добавлении документа.

#### Чтение документа

1. Пользователь выбирает документ для чтения из списка и переходит по ссылке с именем данного документа.
2. Запрос на чтение документа отправляется на сервер.
3. Сервис авторизации выполняет проверку авторизации пользователя. В случае если пользователь авторизован выставляется заголовок, содержащий идентификатор пользователя.
4. Сервис документов проверяет наличие документа, в случае отсутствия генерируется сообщение об ошибке.
5. Сервис документов проверяет права пользователя на чтение документа, в случае отсутствия таковых генерируется сообщение об ошибке.
6. Сервис документов возвращает в ответе содержимое документа.
5. Фронтенд генерирует страницу с содержимым документа.

#### Удаление документа

1. Пользователь выбирает документ из списка и нажимает кнопку "Удалить".
2. Запрос на удаление документа отправляется на сервер.
3. Сервис авторизации выполняет проверку авторизации пользователя. В случае если пользователь авторизован выставляется заголовок, содержащий идентификатор пользователя, иначе генерируется сообщение об ошибке.
4. Сервис документов проверяет наличие документа, в случае отсутствия генерируется сообщение об ошибке.
5. Сервис документов проверяет права пользователя на удаление документа, в случае отсутствия таковых генерируется сообщение об ошибке.
6. Фронтенд генерирует страницу с сообщением об успешном удалении документа.

### Диаграммы прецедентов

![Alt text](https://github.com/studtool/assignment/blob/master/WithoutAuth.PNG)

![Alt text](https://github.com/studtool/assignment/blob/master/WithAuth.PNG)

### Спецификации сценариев

#### Сценарий регистрации пользователя

##### Нормальный ход сценария
| Действия актера | Отклик системы |
| --------------- | -------------- |
| Ввод допустимых адреса электронной почты и пароля. | Система выполняет валидацию данных. Отправляет запрос на сервер. Возвращается сообщение об успешной регистрации. |

##### Альтернативный ход сценария
| Действия актера | Отклик системы |
| --------------- | -------------- |
| Ввод недопустимого адреса электронной почты или пароля. | Система выполняет валидацию данных. Генерируется сообщение об ошибке. |

##### Альтернативный ход сценария
| Действия актера | Отклик системы |
| --------------- | -------------- |
| Ввод существующего адреса электронной почты и допустимого пароля. | Система выполняет валидацию данных. Отправляет запрос на сервер. Возвращается сообщение о том, что пользователь с таким адресом электронной почты уже зарегистрирован. |

## Логический дизайн

### Модель "Сущность - Связь"

![Alt text](https://github.com/studtool/assignment/blob/master/ER.png)

Рис. 4. Модель "Сущность-Связь" (entity-relationship model, ER-модель) для сервиса досок

#### Спецификация сущностей

Сущность **"Пользователь"** представляет собой авторизованного пользователя системы. Атрибуты сущности:

| Имя атрибута | Тип атрибута | Описание атрибута |
| ---- | ---- | ---- |
| ID | text | Уникальный идентификатор пользователя в системе. |

Сущность **"Доска задач"**. Атрибуты сущности:

| Имя атрибута | Тип атрибута | Описание атрибута |
| ---- | ---- | ---- |
| ID | text | Уникальный идентификатор доски. |
| Предмет | text | Учебный предмет, для которого создана доска. |
| Название | text | Название доски задач. |
| Автор | text | Уникальный идентификатор пользователя, создавшего доску. |
| Список участников | array of text | Уникальные идентификаторы пользователей, имеющих право редактировать доску. |

Сущность **"Карточка задачи"**. Атрибуты сущности:

| Имя атрибута | Тип атрибута | Описание атрибута |
| ---- | ---- | ---- |
| ID | int | Уникальный идентификатор карточки в рамках доски. |
| Название | text | Название задачи. |
| Описание | text | Подробное описание задачи. |
| Дата сдачи | date | Дата, до которой задание должно быть выполнено. |

### Диаграмма деятельности

![Alt text](https://github.com/studtool/assignment/blob/master/AUTH.png)

Рис. 5. Диаграмма деятельности для варианта использования "Авторизация" пользователя

### Диаграммы последовательности действий

![Alt text](https://github.com/studtool/assignment/blob/master/REG-C.png)

Рис. 6. Диаграмма последовательности действий при регистрации пользователя (концептуальный уровень)

![Alt text](https://github.com/studtool/assignment/blob/master/REG-D.png)

Рис. 7. Диаграмма последовательности действий при регистрации пользователя (детальный уровень)

### Диаграмма потока данных

![Alt text](https://github.com/studtool/assignment/blob/master/DATA.png)

Рис. 8. Диаграмма потоков данных подсистемы работы с досками

## Высокоуровневый дизайн пользовательского интерфейса

Пользовательский интерфейс системы представляет собой Web-интерфейс, доступ к которому осуществляется через браузер.

Страница портала состоит из «шапки» (верхней части страницы, в которой находится логотип и верхнее меню со ссылками на основные разделы портала), основной части и «футера» (нижней части страницы, в которой обычно размещают ссылки на редко посещаемые, но необходимые, страницы, например, страницы с пользовательским соглашением).
Обобщенно структуру страниц портала можно представить следующим образом:
-	Главная страница
-	Страница регистрации
- Страница авторизации
- Страница с профилем пользователей
- Страница со списком досок
- Страница редактирования выбранной доски
- Страница со списком документов
- Страница редактирования выбранного документа

![Alt text](https://github.com/studtool/assignment/blob/master/MAIN-DESIGN.PNG)

Рис. 9. Главная страница

![Alt text](https://github.com/studtool/assignment/blob/master/REG-DESIGN.PNG)

Рис. 10. Страница регистрации пользователя

![Alt text](https://github.com/studtool/assignment/blob/master/AUTH-DESIGN.PNG)

Рис. 11. Страница авторизации пользователя

## Физический дизайн

### Выбор системы развертывания компонентов распределенной системы

Согласно требованиям технического задания, разрабатываемая система должна быть распределенной. Характерной особенностью распределенных систем является высокое многообразие используемых технологий, языков программирования и библиотек. Для того чтобы компоненты распределенной системы не конфликтовали друг с другом, необходимо ввести требование изолированности. В этом случае приходится использовать отдельные серверы. На начальном этапе проекта это может быть экономически нецелесообразно. Тестирование такой системы также вызовет сложности. Альтернативой является использование виртуальных машин. Виртуализация - это современным подходом к созданию надежной и эффективной серверной инфраструктуры. Она дает возможность, с одной стороны,  динамического распределения существующих аппаратных ресурсов между приложениями в соответствии с их текущими потребностями в производительности, оперативной и дисковой памяти, а с другой стороны – дает возможность оперативной миграции  приложений между физическими серверами, что существенно сокращает время восстановления при сбоях оборудования.

Основные требования для системы развертывания компонентов разрабатываемой системы:
-	Изоляция. Компоненты системы не должны иметь доступа друг к другу, за исключением доступа, предусмотренного протоколом взаимодействия.
-	Управление ресурсами. Компонент системы должен потреблять ограниченное число ресурсов (процессорного времени, оперативной памяти, места на жестком диске).
-	Отслеживание зависимостей. Компонент системы должен разворачиваться монолитно со всеми своими библиотеками. Это требование гарантирует, что компонент будет использоваться с теми же библиотеками, с которыми был протестирован.
-	Низкие накладные расходы. Использование системы развертывания не должно нести высокие накладные расходы для распределенной системы.
- Простота масштабирования. Количество экземпляров запущенного сервиса может быть увеличено или уменьшено в любой момент времени.

Под данные требования наиболее подходит **Docker** — программное обеспечение для автоматизации развёртывания и управления приложениями в средах с поддержкой контейнеризации. Для автоматизации развертывания контейнеров наиболее популярным инструментов является **Kubernetes** — открытое программное обеспечение для автоматизации развёртывания, масштабирования и управления контейнеризированными приложениями.

Согласно общим рекомендациям работы с Docker, считается неверным подходом запускать в контейнере процесс требующий сохранения состояния, как например база данных. Для работы с базами данных, как правило, используются виртуальные машины. Под требования к развертыванию наилучшим образом подходит **Virtual Box**. Одним из наиболее перспективных инструментов управления виртуальными машинами, в том числе Virtual Box, является **Vagrant**.

### Выбор операционной системы

Согласно требованиям технического задания, разрабатываемый портал должен об-ладать высокой доступностью, работать на типичных архитектурах ЭВМ (Intel x86, Intel x64), а так же быть экономически недорогим для сопровождения. Таким образом, можно сформулировать следующие требования к операционной системе:
-	Распространенность. На рынке труда должно быть много специалистов, способных администрировать распределенную систему, работающую под управлением выбранной операционной системы.
-	Надежность. Операционная система должна широко использоваться в стабильных проектах. Эти компании обеспечивают высо-кую работоспособность своих сервисов, и на их опыт можно положиться.
-	Наличие требуемого программного обеспечения. Выбор операционной системы не должен ограничивать разработчиков в выборе программного обеспечения, библиотек.
-	Цена.

Под данные требования лучше всего подходит ОС Ubuntu. Ubuntu — это дистр-бутив, использующий ядро Linux. Как и все дистрибутивы Linux, Ubuntu является ОС с открытым исходным кодом, бесплатным для использования. Его предком является дис-трибутив Debian. Ubuntu простой в эксплуатации дистрибутив, имеющий систему управ-ления пакетами (APT). Поставляется как в клиентской (с графическим интерфейсом), так и в серверной (без графического интерфейса) версиями. Ubuntu поставляется с современ-ными версиями ПО, в отличие от дистрибутивов Debian, CentOS. Преимуществом Ubuntu по сравнению с другими дистрибутивами являются низкие требования к квалификации системных администраторов.

### Выбор СУБД

#### Выбор СУБД для профилей пользователй

Особенности работы с профилями:
-	Преобладают запросы на чтение данных.
- Большинство запросов простые (CRUD-операции).
- Требуется простота масштабирования БД.
- БД хранит общедоступные данные.
- Не предъявляется высоких требований к консистентности данных.

Нереляционная СУБД MongoDB полностью отвечает данным условиям. MongoDB - нереляционная система управления базами данных. Относится к классу документо-ориентированных СУБД. В качестве языка запросов используется язык, в основе которого лежит JavaScript.  JavaScript легок для освоения, что снижает порог вхождения для эксплуатации этой СУБД. Документы хранятся в виде JSON - стандартном для JavaScript способе представления данных. Эта СУБД поддерживает индексацию, гео-графические типы данных, профилирование запросов (выявление статистики потребления ресурсов запросами), репликацию, шардирование. MongoDB не поддерживает транзакции. Эта СУБД не требует описания схемы данных.

#### Выбор СУБД для данных авторизации

Особенности работы с данными авторизации:
- Практически равное соотношение числа запросов на запись и на чтение.
- Требуется выполнение сложных запросов (не только CRUD-операции).
- Предъявляются высокие требования к консистентности данных.
- БД хранит конфиденциальные данные.

Реляционная СУБД PostgreSQL полностью отвечает данным условиям.

#### Выбор СУБД для досок задач

Особенности работы с данными авторизации:
- Практически равное соотношение числа запросов на запись и на чтение.
- Преобладают сложные запросы.
- Консистентностью данных возможно пренебречь в пользу высокой доступности.
- БД хранит закрытые данные.

Реляционная СУБД MySQL полностью отвечает данным условиям.

### Выбор языка программирования для разработки серверной части системы

К выбору языка программирования предъявляются следующие требования:
- Высокая скорость разработки.
- Обширная стандартная библиотека.
- Простота разработки многопоточных приложений.

Данным требованиям соответствует язык программирования Go, разработанный специально для написания веб-приложений.

### Обеспечение надежности

В данной системе для обеспечения надежности функционирования СУБД  будет применяться  репликация типа «ведущий – ведомый» и шардинг. Для обеспечения надежности данных СУБД необходимо разработать скрипт для автоматического создания резервной копий базы данных по расписанию.

Для серверных компонентов системы целесообразно применить зеркалирование. Это обеспечит отказоустойчивость системы: в случае сбоя любого из ее узлов запросы на чтение данных будут выполняться. Отказоустойчивость фронтенда возможно за счет его зеркалирования на несколько серверов. Выбор одного из зеркалируемых серверов осуществляется с помощью прописывания в DNS (система доменных имен) записях адресов всех серверов, на которых располагаются фронтенды. При выполнении запроса к порталу браузер клиента выполняет запрос к DNS серверам и получает в ответ список ip-адресов фронтендов портала. Далее браузер выбирает один из данных фронтендов и осуществляет к нему запрос. Отказоустойчивость бекендов будет выполняться за счет их зеркалирования, выбором нужного бекенда (по запросу к порталу)  занимается фронтенд.
